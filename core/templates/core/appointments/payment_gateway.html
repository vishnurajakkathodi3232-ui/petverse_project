{% extends "core/base_inner.html" %}

{% block title %}Appointment Payment | PetVerse{% endblock %}

{% block content %}

<style>
    .pay-card {
        background: #faf7f2;
        border: 1px solid #e6dfd4;
        border-radius: 14px;
        padding: 28px;
        max-width: 560px;
        margin: auto;
    }

    .amount-box {
        background: #ffffff;
        border: 1px dashed #d6cfc4;
        border-radius: 12px;
        padding: 18px;
        margin: 20px 0;
    }

    .amount-main {
        font-size: 26px;
        font-weight: 700;
        color: #2e8b57;
    }

    .muted {
        color: #777;
        font-size: 13px;
    }
</style>

<div class="container" style="margin-top:120px;">

    <div class="pay-card text-center">

        <h3 class="mb-2">
            Secure Appointment Payment üí≥
        </h3>

        <p class="text-muted">
            Complete payment to confirm your appointment
        </p>

        <hr>

        <!-- APPOINTMENT DETAILS -->
        <p class="mb-1">
            <strong>Pet:</strong> {{ appointment.owned_pet.pet.name }}
        </p>

        <p class="mb-1">
            <strong>Service:</strong> {{ appointment.service.name }}
        </p>

        <p class="mb-2">
            <strong>Date:</strong>
            {{ appointment.appointment_date }}
            |
            {{ appointment.appointment_time }}
        </p>

        <!-- AMOUNT -->
        <div class="amount-box">
        <p class="muted mb-1">
            Payable Amount
        </p>

            <strong>‚Çπ {{ appointment.service.price }}</strong>

            <hr>

            <div class="amount-main">
                ‚Çπ {{ payment.amount }}
            </div>

            <p class="muted mt-1">
                Total Payable Amount
            </p>

        </div>

        <!-- PAY BUTTON -->
        <button id="rzp-button"
                class="btn btn-success btn-lg btn-block">
            Pay & Confirm Appointment
        </button>

        <div class="mt-3">
            <a href="{% url 'adopter_appointments' %}"
               class="btn btn-link">
                ‚Üê Cancel & Go Back
            </a>
        </div>

        <p class="muted mt-3">
            Secure payment powered by Razorpay
        </p>

    </div>

</div>

<!-- Razorpay Script -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
    var options = {
        "key": "{{ razorpay_key }}",
        "amount": "{{ amount }}", // paise
        "currency": "INR",
        "name": "PetVerse",
        "description": "Appointment Payment",
        "order_id": "{{ razorpay_order_id }}",

        "handler": function (response) {

            var form = document.createElement("form");
            form.method = "POST";
            form.action = "{% url 'appointment_payment_success' payment.id %}";

            var csrfToken = "{{ csrf_token }}";

            form.innerHTML = `
                <input type="hidden" name="csrfmiddlewaretoken" value="${csrfToken}">
                <input type="hidden" name="razorpay_payment_id" value="${response.razorpay_payment_id}">
                <input type="hidden" name="razorpay_order_id" value="${response.razorpay_order_id}">
                <input type="hidden" name="razorpay_signature" value="${response.razorpay_signature}">
            `;

            document.body.appendChild(form);
            form.submit();
        },

        "theme": {
            "color": "#2e8b57"
        }
    };

    var rzp = new Razorpay(options);

    document.getElementById("rzp-button").onclick = function (e) {
        rzp.open();
        e.preventDefault();
    };
</script>

{% endblock %}
